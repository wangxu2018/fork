# **进程相关概述**

## **进程和程序**

- 程序：死的。只占用磁盘空间。        ――剧本
- 进程：活的。运行起来的程序。占用内存、cpu等系统资源。    ――戏

## **MMU**

- 虚拟内存映射单元，CPU内部重要的组件之一。

- **MMU作用**

  ```
  - 完成进程虚拟内存地址与物理内存之间的映射，使得一定大小的内存空间可以运行多个进程。
  - 完成用户空间和内核空间之间的权级切换。
  ```

## **虚拟内存地址**

- 每个进程会被分配4G的虚拟内存空间，其中0-3G为用户态，3-4G为内核态。

## **进程控制块**

- 在虚拟内存地址3-4G的空间中，会包含PCB（进程控制块），PCB是一个描述进程信息的结构体。

- **PCB中包含的资源**

  ```
  - 进程id
  - 文件描述符表：该进程用到的文件描述符的集合，最大为1024个，可通过修改内核代码修改上线
  - 进程状态：初始态、就绪态、运行态、挂起态、终止态
  - 进程工作目录位置
  - umask掩码
  - 信号相关信息资源
  - 用户id和组id
  ```

## **父子进程**

- **父子进程相同**

  ```
  - 创建子进程的时候，会把父进程0-4G的虚拟内存地址复制一份给子进程。
  - 因此刚fork完，父子进程相同的有：data段、text段、堆、栈、环境变量、全局变量、宿主目录位置、进程工作目录位置、信号处理方式。
  ```

- **父子进程不同**

  ```
  进程id、返回值、各自的父进程、进程创建时间、闹钟、未决信号集
  ```

- **父子进程共享**

  ```
  - 对于全局变量来说，读时共享、写时复制
  - 共享已经打开的文件描述符
  - 共享mmap映射区（待了解）
  ```

  

## **相关函数**

- **pid_t fork(void)**
  - 创建子进程，父子进程各自返回。
  - 创建成功后，父进程返回子进程pid，子进程返回 0.

- **getpid()，getppid()**
  - 获取父进程的id、父父继承的id

